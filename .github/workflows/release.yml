name: Android app Release

on:
    push:
        branches: [main]

jobs:
    # version:
    #     name: Create version number
    #     runs-on: ubuntu-latest
    #     steps:
    #         - name: Checkout
    #           uses: actions/checkout@v2

    #         - name: Install GitVersion
    #           uses: gittools/actions/gitversion/setup@v0.9.7
    #           with:
    #               versionSpec: "5.x"

    #         - name: Use GitVersion
    #           id: gitversion
    #           uses: gittools/actions/gitversion/execute@v0.9.7

    #         - name: Create version.txt with nuGetVersion
    #           run: echo ${{ steps.gitversion.outputs.nuGetVersion  }} > version.txt
    #         - name: Upload version.txt
    #           uses: actions/upload-artifact@v2
    #           with:
    #               name: gitversion
    #               path: version.txt
    build:
        name: Build APK and Create release
        permissions:
          contents: write
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v2

            - uses: subosito/flutter-action@v2
              with:
                  channel: "stable"
            - run: flutter pub get
            - run: flutter build apk --release --split-per-abi
            - run: flutter build appbundle
            - name: Create a Release in GitHub
              uses: ncipollo/release-action@v1.10.0
              with:
                  artifacts: "build/app/outputs/apk/release/*.apk,build/app/outputs/bundle/release/app-release.aab"
                  token: ${{ secrets.GH_TOKEN }}
                  name: "Latest Build"
                  tag: "latest"
                  commit: ${{ github.sha }}
