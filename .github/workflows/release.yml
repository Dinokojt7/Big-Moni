name: Android app Release

on:
    push:
        branches: [main]

jobs:
    # version:
    #     name: Create version number
    #     runs-on: ubuntu-latest
    #     steps:
    #         - name: Checkout
    #           uses: actions/checkout@v2

    #         - name: Install GitVersion
    #           uses: gittools/actions/gitversion/setup@v0.9.7
    #           with:
    #               versionSpec: "5.x"

    #         - name: Use GitVersion
    #           id: gitversion
    #           uses: gittools/actions/gitversion/execute@v0.9.7

    #         - name: Create version.txt with nuGetVersion
    #           run: echo ${{ steps.gitversion.outputs.nuGetVersion  }} > version.txt
    #         - name: Upload version.txt
    #           uses: actions/upload-artifact@v2
    #           with:
    #               name: gitversion
    #               path: version.txt
    build:
        name: Build APK and Create release
        permissions:
            contents: write
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v2

            - uses: subosito/flutter-action@v2
              with:
                  channel: "stable"
            - run: flutter pub get

            - name: Create APK
              run: |
                  flutter build apk
                  mkdir Release
                  mv build/app/outputs/apk/release/*.apk Release/

            - name: Upload Artifact
              uses: actions/upload-artifact@v2
              with:
                  name: BigBucks
                  path: Release
            
            - name: Create Release
              id: create_release
              uses: actions/create_release@v1
              env:
                GITHUB_TOKEN: ${{ secrets.GH_SECRET }}
              with:
                tag_name: ${{ github.ref }}
                release_name: Release ${{ github.ref }}
                draft: false
                prerelease: true
            
            - name: Upload Release Assset
              id: upload-release-asset
              uses: actions/upload-release-assset@v1
              env: 
                GITHUB_TOKEN: ${{ secrets.GH_SECRET }}
              with:
                upload_url: ${{ steps.create_release.outputs.upload_url }}
                asset_path: ./Releases
                asset_name: Latest


